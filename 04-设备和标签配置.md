# 🔌 FUXA 设备和标签配置教程

---

## 📋 概述

在 FUXA 中，**设备**（Device）和**标签**（Tag）是数据采集的核心概念：

- **设备**：表示与外部设备（PLC、传感器等）的连接
- **标签**：表示从设备读取的具体数据点（温度、压力、开关状态等）

---

## 🎯 配置流程

```
┌─────────────────────────────────────────────────────────┐
│  设备和标签配置流程                                        │
├─────────────────────────────────────────────────────────┤
│  1️⃣ 进入编辑器的"连接"（Connections）页面                 │
│  2️⃣ 添加设备连接                                          │
│  3️⃣ 配置设备通信参数                                      │
│  4️⃣ 测试设备连接                                          │
│  5️⃣ 添加数据标签                                          │
│  6️⃣ 配置标签属性                                          │
└─────────────────────────────────────────────────────────┘
```

---

## 🚀 快速开始

### 步骤 1：进入连接配置页面

在 FUXA 编辑器中，点击左侧菜单的 **"连接"**（Connections）选项。

![](images/setup-connections.png)

---

## 📡 添加设备连接

### 1️⃣ OPC UA 设备

OPC UA 是工业自动化的标准协议，广泛应用于各种工业设备。

#### 添加步骤

1. 点击"添加设备"按钮
2. 设备类型选择 **"OPC UA"**
3. 填写设备名称（如：OPC_UA_Server）
4. 配置连接参数：
   - **端点 URL**：如 `opc.tcp://192.168.1.100:4840`
   - **安全策略**：None/Basic128Rsa15/Basic256
   - **用户名/密码**：如需要认证
5. 点击"测试连接"
6. 连接成功后点击"保存"

![](images/fuxa-device.gif)

#### 添加 OPC UA 标签

**⚠️ 重要**：设备必须先连接成功才能添加标签。

1. 点击设备展开标签列表
2. 点击"添加标签"按钮
3. 浏览 OPC UA 服务器节点树
4. 选择要监控的数据点
5. 配置标签属性：
   - **标签名称**：如 `PLC_温度`
   - **数据类型**：自动检测或手动选择
   - **采样间隔**：数据更新频率（如 1000ms）
6. 点击"保存"

![](images/fuxa-opcuatag.gif)

---

### 2️⃣ Modbus 设备

Modbus 是最常用的工业通信协议之一，支持 RTU（串口）和 TCP（以太网）两种模式。

#### 前置要求

在添加 Modbus 连接之前，需要在 **"插件"**（Plugins）中安装 Modbus 驱动。

#### 添加 Modbus RTU 设备

1. 点击"添加设备"按钮
2. 设备类型选择 **"Modbus > Modbus RTU"**
3. 配置连接参数：

| 参数 | 说明 | 示例 |
|------|------|------|
| **串口** | 串口设备路径 | `/dev/ttyUSB0` 或 `COM1` |
| **波特率** | 通信速率 | 9600, 19200, 38400 |
| **数据位** | 数据位数 | 7, 8 |
| **停止位** | 停止位数 | 1, 2 |
| **校验位** | 校验方式 | None, Even, Odd |
| **从站地址** | Modbus 从站 ID | 1-247 |

4. 点击"测试连接"
5. 连接成功后点击"保存"

#### 添加 Modbus TCP 设备

1. 点击"添加设备"按钮
2. 设备类型选择 **"Modbus > Modbus TCP"**
3. 配置连接参数：

| 参数 | 说明 | 示例 |
|------|------|------|
| **IP 地址** | 设备 IP 地址 | `192.168.1.101` |
| **端口** | Modbus TCP 端口 | `502` |
| **从站地址** | Modbus 从站 ID | `1-247` |
| **超时时间** | 连接超时（毫秒） | `3000` |

4. 点击"测试连接"
5. 连接成功后点击"保存"

![](images/fuxa-modbus.gif)

#### 添加 Modbus 标签

1. 点击设备展开标签列表
2. 点击"添加标签"按钮
3. 配置标签属性：

| 参数 | 说明 | 示例 |
|------|------|------|
| **标签名称** | 标签标识 | `Modbus_温度` |
| **功能码** | Modbus 功能码 | 3（读保持寄存器） |
| **寄存器地址** | 起始地址 | `40001` |
| **数据类型** | 数据类型 | Float, Int16, UInt16 |
| **数量** | 读取数量 | `1` |
| **单位** | 数据单位 | `℃`, `bar` |

4. 点击"保存"

---

### 3️⃣ MQTT 设备

MQTT 是轻量级的物联网消息协议，适合连接 IoT 设备。

#### 添加 MQTT 连接

1. 点击"添加设备"按钮
2. 设备类型选择 **"MQTT"**
3. 配置连接参数：

| 参数 | 说明 | 示例 |
|------|------|------|
| **Broker 地址** | MQTT 服务器地址 | `192.168.1.102` |
| **端口** | MQTT 端口 | `1883`（非加密）或 `8883`（加密） |
| **客户端 ID** | 客户端标识 | `fuxa_client` |
| **用户名/密码** | 认证信息 | 如需要 |
| **QoS** | 服务质量等级 | 0, 1, 2 |

4. 点击"测试连接"
5. 连接成功后点击"保存"

![](images/fuxa-mqtt.gif)

#### 添加 MQTT 订阅（标签）

1. 点击设备展开标签列表
2. 点击"添加标签"按钮
3. 配置订阅属性：

| 参数 | 说明 | 示例 |
|------|------|------|
| **标签名称** | 标签标识 | `MQTT_温度` |
| **主题** | MQTT 主题 | `factory/zone1/temperature` |
| **QoS** | 服务质量等级 | 0, 1, 2 |
| **数据类型** | 数据类型 | Float, Int, String |
| **JSON 路径** | JSON 数据路径（如需要） | `$.value` |

4. 点击"保存"

---

### 4️⃣ WebAPI 设备

WebAPI 允许从 REST API 获取 JSON 格式的数据。

#### 添加 WebAPI 连接

1. 点击"添加设备"按钮
2. 设备类型选择 **"WebAPI"**
3. 配置连接参数：

| 参数 | 说明 | 示例 |
|------|------|------|
| **基础 URL** | API 基础地址 | `http://api.example.com` |
| **请求方法** | HTTP 方法 | GET, POST |
| **请求头** | 自定义请求头 | `Authorization: Bearer xxx` |
| **超时时间** | 请求超时（毫秒） | `5000` |

4. 点击"测试连接"
5. 连接成功后点击"保存"

![](images/fuxa-webapi.gif)

#### 添加 WebAPI 标签

1. 点击设备展开标签列表
2. 点击"添加标签"按钮
3. 配置标签属性：

| 参数 | 说明 | 示例 |
|------|------|------|
| **标签名称** | 标签标识 | `API_温度` |
| **端点路径** | API 路径 | `/sensors/temperature` |
| **数据类型** | 数据类型 | Float, Int, String |
| **JSON 路径** | JSON 数据路径 | `$.data.value` |
| **刷新间隔** | 刷新频率（毫秒） | `5000` |

4. 点击"保存"

---

## ⚙️ 标签高级选项

### 数据类型设置

如果您的标签类型没有定义的数据类型，可以手动设置。

**示例**：TIME 数据类型不是预定义类型，但基础数据类型通常是 int64 或 uint64，时间以毫秒为单位。

![](https://github.com/user-attachments/assets/6fbbd718-2ab0-4bac-85dd-8f0339540ca5)

### 缩放脚本（Scale Script）

您可以在标签选项中使用缩放脚本进行数据类型转换等操作。

**示例**：TIME 数据是一个包含 LOW 和 HIGH 的数组，我们可以创建一个简单的脚本来获取数组元素并返回为数字类型。

![](https://github.com/user-attachments/assets/3acb42db-bfee-4eed-a385-e8fe264e7ddd)

#### ⚠️ 重要提示

1. **脚本参数必须命名为 `value`**，因为有一个过滤器来显示相关的脚本供选择
2. **不要在此脚本中使用注释**，因为不支持注释

#### 读取脚本示例

返回数组元素的读取脚本：

```javascript
// 读取脚本：从 TIME 数组中提取值
function value(val) {
  // val 是从设备读取的原始值（数组）
  // 返回第一个元素作为实际值
  return val[0];
}
```

![](https://github.com/user-attachments/assets/60b5ce2b-4354-4b18-bc4f-eb73e9fc5bd0)

#### 写入脚本示例

返回实际标签值的写入脚本：

```javascript
// 写入脚本：将值转换为设备需要的格式
function value(val) {
  // val 是要写入的值
  // 返回设备需要的格式（数组）
  return [val];
}
```

![](https://github.com/user-attachments/assets/51cfad3f-9354-45e5-a0a5-206507d1ca93)

---

## 📊 标签属性详解

### 基本属性

| 属性 | 说明 | 示例 |
|------|------|------|
| **标签名称** | 唯一标识符 | `PLC_车间1_温度` |
| **设备** | 关联的设备 | `PLC_S71200` |
| **数据类型** | 数据类型 | Float, Int16, Bool, String |
| **地址** | 设备地址 | `DB1.DBD0` 或 `40001` |
| **单位** | 数据单位 | `℃`, `bar`, `m/s` |
| **描述** | 标签说明 | `车间1温度传感器` |

### 高级属性

| 属性 | 说明 | 示例 |
|------|------|------|
| **采样间隔** | 数据更新频率 | `1000`（毫秒） |
| **死区** | 变化阈值（减少更新） | `0.5` |
| **最小值/最大值** | 数据范围 | `0` / `100` |
| **初始值** | 启动时的默认值 | `0` |
| **只读** | 是否只读 | `true` / `false` |

---

## 💡 最佳实践

### 1️⃣ 命名规范

使用清晰的命名规范，便于管理和维护：

```
设备类型_位置_参数_单位
```

**示例**：
- `PLC_车间1_温度_℃`
- `Modbus_车间2_压力_bar`
- `MQTT_设备1_状态`

### 2️⃣ 标签分组

使用前缀或后缀对标签进行分组：

```
# 按车间分组
车间1_温度
车间1_压力
车间2_温度
车间2_压力

# 按设备分组
PLC1_温度
PLC1_压力
PLC2_温度
PLC2_压力
```

### 3️⃣ 数据类型选择

根据实际数据选择合适的数据类型：

| 数据类型 | 适用场景 | 范围 |
|---------|---------|------|
| **Bool** | 开关状态 | true/false |
| **Int16** | 整数 | -32768 ~ 32767 |
| **UInt16** | 无符号整数 | 0 ~ 65535 |
| **Int32** | 大整数 | -2^31 ~ 2^31-1 |
| **Float** | 浮点数 | ±3.4E38 |
| **String** | 文本 | 任意字符串 |

### 4️⃣ 采样间隔设置

合理设置采样间隔，平衡实时性和性能：

| 数据类型 | 建议采样间隔 | 说明 |
|---------|-------------|------|
| **实时控制** | 100-500ms | 需要快速响应的控制信号 |
| **过程监控** | 1000-2000ms | 温度、压力等过程参数 |
| **状态监控** | 5000-10000ms | 设备状态、报警信息 |
| **历史数据** | 10000-60000ms | 用于趋势分析的数据 |

---

## ❓ 常见问题

### ❓ 设备连接失败

**可能原因**：
1. IP 地址或端口错误
2. 网络不通
3. 设备未启动
4. 防火墙阻止

**解决方案**：
1. 检查设备 IP 地址和端口
2. 使用 ping 命令测试网络连通性
3. 确认设备已上电并运行
4. 检查防火墙设置

### ❓ 标签数据不更新

**可能原因**：
1. 标签地址错误
2. 设备未输出数据
3. 采样间隔设置过大

**解决方案**：
1. 检查标签地址是否正确
2. 确认设备正在输出数据
3. 调整采样间隔

### ❓ 数据类型不匹配

**可能原因**：
1. 设备数据类型与标签设置不一致
2. 需要使用缩放脚本转换

**解决方案**：
1. 检查设备数据类型
2. 使用缩放脚本进行类型转换

---

## 🎉 总结

通过本教程，您已经学会了：

✅ 添加各种类型的设备连接（OPC UA、Modbus、MQTT、WebAPI）  
✅ 配置设备通信参数  
✅ 添加和配置数据标签  
✅ 使用高级选项（数据类型、缩放脚本）  
✅ 遵循最佳实践

下一步，学习如何使用这些标签创建可视化界面！

---

> 💡 **提示**：建议在添加大量标签前，先测试几个标签确保通信正常。

---

**关注我们，获取更多工业自动化技术干货！** 🎯

<div style="display: flex; justify-content: center; align-items: center; gap: 40px; margin: 30px 0;">
    <div style="text-align: center;">
        <img src="images/微信公众号.jpg" alt="微信公众号" style="width: 200px; height: 200px; object-fit: contain;">
        <p style="margin: 10px 0 0 0; font-size: 14px; color: #666;">微信公众号</p>
    </div>
    <div style="text-align: center;">
        <img src="images/单人二维码.png" alt="技术支持" style="width: 200px; height: 200px; object-fit: contain;">
        <p style="margin: 10px 0 0 0; font-size: 14px; color: #666;">技术支持</p>
    </div>
</div>

