# 🎨 FUXA 自定义形状定义教程

---

## 📋 概述

FUXA 允许您定义自定义形状，扩展编辑器的图形库，以满足特定的工业可视化需求。

---

## 🎯 形状文件位置

形状文件夹位于：`client/dist/assets/lib/svgeditor/shapes`（如果您正在调试，则在 `client/src/lib/svgeditor/shapes`）。

您可以通过创建新的 JavaScript 文件（最好从 `my-shapes.js` 复制）或编辑现有文件来添加新形状。

---

## 🔧 配置形状文件

### 基本配置

在 JavaScript 文件中，您可以更改以下内容：

```javascript
var shapesGroupName = 'Shapes';  // 用于组织和分组形状，在编辑器菜单中显示为可展开/折叠的标签

var typeId = 'shapes';  // 用于标识形状类型，'shapes' 与 Angular 组件 'ShapesComponent' 绑定
                       // 如果您创建新类型，还必须实现相应的 Angular 组件
```

### 形状数据数组

在此数组中定义您的形状数据，形状对象具有以下属性：

```javascript
var shapes = [
  {
    name: 'diamond',  // 形状类型的唯一名称
    ico: 'assets/lib/svgeditor/shapes/img/shape-diamond.svg',  // 在编辑器菜单中显示的图标路径
    content: [  // SVG 元素数组
      {
        id: '',  // 元素 ID，如果您想在 Angular 组件中管理动画，可以使用此 ID
        type: 'path',  // SVG 元素类型（path, text, ellipse,...），参见 SVG 文档
        attr: {  // 元素属性，取决于类型
          d: 'M 20 0 L 40 20 L 20 40 L 0 20 Z'
        }
      }
    ]
  },
  // ... 更多形状
];
```

### 属性说明

| 属性 | 说明 | 示例 |
|------|------|------|
| **name** | 形状类型的唯一名称 | 'diamond', 'circle', 'pump' |
| **ico** | 在编辑器菜单中显示的图标路径 | 'assets/lib/svgeditor/shapes/img/shape-diamond.svg' |
| **content** | SVG 元素数组 | 包含一个或多个 SVG 元素的数组 |
| **id** | 元素 ID，用于动画管理 | 'pump-blade', 'valve-handle' |
| **type** | SVG 元素类型 | 'path', 'text', 'ellipse', 'rect', 'circle' |
| **attr** | 元素属性，取决于类型 | { d: 'M 20 0 L 40 20 L 20 40 L 0 20 Z' } |

---

## 🎨 设计形状

### 使用 Inkscape 设计

要设计我的形状，我使用了 Inkscape 应用程序。您可以使用 XML 编辑器查看元素和节点属性，以便添加到 'type' 和 'attr' 中。

### 设计步骤

1. 打开 Inkscape
2. 创建或导入形状
3. 使用 XML 编辑器查看元素
4. 复制元素属性到形状文件

### 示例：菱形

```javascript
{
  name: 'diamond',
  ico: 'assets/lib/svgeditor/shapes/img/shape-diamond.svg',
  content: [
    {
      id: '',
      type: 'path',
      attr: {
        d: 'M 20 0 L 40 20 L 20 40 L 0 20 Z',
        fill: '#3498db',
        stroke: '#2c3e50',
        'stroke-width': 2
      }
    }
  ]
}
```

### 示例：圆形

```javascript
{
  name: 'circle',
  ico: 'assets/lib/svgeditor/shapes/img/shape-circle.svg',
  content: [
    {
      id: '',
      type: 'circle',
      attr: {
        cx: 20,
        cy: 20,
        r: 18,
        fill: '#e74c3c',
        stroke: '#2c3e50',
        'stroke-width': 2
      }
    }
  ]
}
```

### 示例：矩形

```javascript
{
  name: 'rectangle',
  ico: 'assets/lib/svgeditor/shapes/img/shape-rectangle.svg',
  content: [
    {
      id: '',
      type: 'rect',
      attr: {
        x: 0,
        y: 0,
        width: 40,
        height: 40,
        fill: '#2ecc71',
        stroke: '#2c3e50',
        'stroke-width': 2
      }
    }
  ]
}
```

### 示例：文本

```javascript
{
  name: 'text',
  ico: 'assets/lib/svgeditor/shapes/img/shape-text.svg',
  content: [
    {
      id: '',
      type: 'text',
      attr: {
        x: 20,
        y: 20,
        'text-anchor': 'middle',
        'font-size': 14,
        fill: '#2c3e50'
      },
      text: 'Text'
    }
  ]
}
```

---

## ⚠️ 重要提示

**!您必须保留文件其余部分的内容！**

不要删除或修改文件中的其他内容，只添加或修改形状数据。

---

## 📂 加载新形状文件

### 添加到加载器

如果您创建了新的 JavaScript 形状文件，还必须将其添加到加载器中。

### 配置步骤

1. 打开 `shapesLoader.js`
2. 添加您的文件名，该文件将被动态加载
3. 不要删除 `shapesLoader.js`

```javascript
var shapesToLoad = [
  'my-shapes.js',
  'your-shape-file-name.js'
];
```

---

## 🎭 创建新形状类型

### 实现组件

如果您创建了新的形状类型，例如定义自己的动画，还必须实现相应的 Angular 组件。

### 组件位置

最好查看 `client/src/app/gauges/shapes/` 中的文件内容。

### 组件示例

```javascript
import { Component, Input, OnInit } from '@angular/core';

@Component({
  selector: 'app-my-shape',
  templateUrl: './my-shape.component.html',
  styleUrls: ['./my-shape.component.css']
})
export class MyShapeComponent implements OnInit {
  @Input() id: string;
  @Input() tagId: string;
  @Input() value: any;

  constructor() { }

  ngOnInit(): void {
    // 初始化逻辑
  }

  updateAnimation(value: any): void {
    // 更新动画逻辑
  }
}
```

---

## 💡 完整示例

### 示例 1：自定义泵形状

```javascript
// my-pumps.js
var shapesGroupName = 'Pumps';

var typeId = 'shapes';

var shapes = [
  {
    name: 'pump',
    ico: 'assets/lib/svgeditor/shapes/img/pump.svg',
    content: [
      {
        id: 'pump-body',
        type: 'circle',
        attr: {
          cx: 30,
          cy: 30,
          r: 25,
          fill: '#3498db',
          stroke: '#2c3e50',
          'stroke-width': 3
        }
      },
      {
        id: 'pump-blade',
        type: 'path',
        attr: {
          d: 'M 30 10 L 30 50',
          stroke: '#ecf0f1',
          'stroke-width': 4
        }
      },
      {
        id: 'pump-label',
        type: 'text',
        attr: {
          x: 30,
          y: 35,
          'text-anchor': 'middle',
          'font-size': 12,
          fill: '#ecf0f1'
        },
        text: 'PUMP'
      }
    ]
  }
];
```

### 示例 2：自定义阀门形状

```javascript
// my-valves.js
var shapesGroupName = 'Valves';

var typeId = 'shapes';

var shapes = [
  {
    name: 'valve',
    ico: 'assets/lib/svgeditor/shapes/img/valve.svg',
    content: [
      {
        id: 'valve-body',
        type: 'path',
        attr: {
          d: 'M 20 0 L 40 20 L 20 40 L 0 20 Z',
          fill: '#e74c3c',
          stroke: '#2c3e50',
          'stroke-width': 2
        }
      },
      {
        id: 'valve-handle',
        type: 'rect',
        attr: {
          x: 15,
          y: 15,
          width: 10,
          height: 10,
          fill: '#ecf0f1',
          stroke: '#2c3e50',
          'stroke-width': 1
        }
      }
    ]
  }
];
```

### 示例 3：自定义管道形状

```javascript
// my-pipes.js
var shapesGroupName = 'Pipes';

var typeId = 'shapes';

var shapes = [
  {
    name: 'pipe-horizontal',
    ico: 'assets/lib/svgeditor/shapes/img/pipe-horizontal.svg',
    content: [
      {
        id: 'pipe-body',
        type: 'rect',
        attr: {
          x: 0,
          y: 15,
          width: 60,
          height: 10,
          fill: '#95a5a6',
          stroke: '#2c3e50',
          'stroke-width': 2
        }
      },
      {
        id: 'pipe-flow',
        type: 'path',
        attr: {
          d: 'M 10 20 L 20 20',
          stroke: '#3498db',
          'stroke-width': 3,
          'stroke-dasharray': '5,5'
        }
      }
    ]
  },
  {
    name: 'pipe-vertical',
    ico: 'assets/lib/svgeditor/shapes/img/pipe-vertical.svg',
    content: [
      {
        id: 'pipe-body',
        type: 'rect',
        attr: {
          x: 15,
          y: 0,
          width: 10,
          height: 60,
          fill: '#95a5a6',
          stroke: '#2c3e50',
          'stroke-width': 2
        }
      },
      {
        id: 'pipe-flow',
        type: 'path',
        attr: {
          d: 'M 20 10 L 20 20',
          stroke: '#3498db',
          'stroke-width': 3,
          'stroke-dasharray': '5,5'
        }
      }
    ]
  }
];
```

---

## 🔧 故障排除

### 常见问题

#### ❓ 形状不显示

**可能原因**：
- 文件未添加到加载器
- 文件路径错误
- 形状数据格式错误

**解决方案**：
1. 检查文件是否添加到 `shapesLoader.js`
2. 验证文件路径是否正确
3. 检查形状数据格式

---

#### ❓ 动画不工作

**可能原因**：
- 元素 ID 未设置
- 组件未实现
- 绑定错误

**解决方案**：
1. 确保元素 ID 已设置
2. 实现相应的 Angular 组件
3. 检查标签绑定

---

#### ❓ 图标不显示

**可能原因**：
- 图标路径错误
- 图标文件不存在
- 文件格式不支持

**解决方案**：
1. 检查图标路径是否正确
2. 确认图标文件是否存在
3. 验证文件格式（推荐 SVG）

---

## 📚 最佳实践

### 1️⃣ 命名规范

- 使用有意义的名称
- 保持命名一致性
- 例如：`pump`、`valve`、`pipe-horizontal`

### 2️⃣ 组织结构

- 按类型分组形状
- 使用清晰的组名
- 例如：`Pumps`、`Valves`、`Pipes`

### 3️⃣ 设计一致性

- 保持设计风格一致
- 使用统一的颜色方案
- 遵循设计规范

### 4️⃣ 文档化

- 记录形状用途
- 说明动画逻辑
- 提供使用示例

---

## 🎉 总结

通过本教程，您已经学会了：

✅ 了解形状文件位置  
✅ 配置形状文件  
✅ 设计自定义形状  
✅ 加载新形状文件  
✅ 创建新形状类型  
✅ 应用完整示例  
✅ 故障排除  
✅ 应用最佳实践  

现在您可以在 FUXA 中创建自定义形状了！

---

## 📚 快速参考

### SVG 元素类型对照表

| 类型 | 说明 | 常用属性 |
|------|------|----------|
| **path** | 路径 | d, fill, stroke |
| **circle** | 圆形 | cx, cy, r, fill, stroke |
| **ellipse** | 椭圆 | cx, cy, rx, ry, fill, stroke |
| **rect** | 矩形 | x, y, width, height, fill, stroke |
| **text** | 文本 | x, y, 'text-anchor', 'font-size', fill |
| **line** | 线条 | x1, y1, x2, y2, stroke |
| **polygon** | 多边形 | points, fill, stroke |

---

> 💡 **提示**：建议使用 Inkscape 等矢量图形编辑工具设计形状，然后导出为 SVG 格式，再手动转换为形状文件格式。

---

**关注我们，获取更多工业自动化技术干货！** 🎯

<div style="display: flex; justify-content: center; align-items: center; gap: 40px; margin: 30px 0;">
    <div style="text-align: center;">
        <img src="images/微信公众号.jpg" alt="微信公众号" style="width: 200px; height: 200px; object-fit: contain;">
        <p style="margin: 10px 0 0 0; font-size: 14px; color: #666;">微信公众号</p>
    </div>
    <div style="text-align: center;">
        <img src="images/单人二维码.png" alt="技术支持" style="width: 200px; height: 200px; object-fit: contain;">
        <p style="margin: 10px 0 0 0; font-size: 14px; color: #666;">技术支持</p>
    </div>
</div>

