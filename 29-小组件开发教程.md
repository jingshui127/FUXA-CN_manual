# ğŸ§© FUXA å°ç»„ä»¶å¼€å‘æ•™ç¨‹

---

## ğŸ“‹ æ¦‚è¿°

FUXA å°ç»„ä»¶ï¼ˆWidgetsï¼‰ä½¿ç”¨çº¯ SVG å’Œ JavaScriptï¼Œé€šè¿‡ script æ ‡ç­¾å®ç°è‡ªå®šä¹‰åŠŸèƒ½ã€‚

---

## ğŸ¯ å°ç»„ä»¶ç»“æ„

### åŸºæœ¬ç»“æ„

FUXA å°ç»„ä»¶çš„åŸºæœ¬ç»“æ„å¦‚ä¸‹ï¼š

```html
<svg>
  SVG å†…å®¹åœ¨è¿™é‡Œ
  <script>
    JavaScript è„šæœ¬å†…å®¹åœ¨è¿™é‡Œ
  </script>
</svg>
```

---

## ğŸ”„ æ•°æ®ä¼ è¾“

### å…¨å±€å˜é‡

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›ç®€å•çš„å‡½æ•°å¹¶åœ¨ SVG è„šæœ¬ä¸­å°†å˜é‡å£°æ˜ä¸ºå…¨å±€å˜é‡æ¥åœ¨ SVG è„šæœ¬ä¹‹é—´ä¼ è¾“æ•°æ®ï¼š

| å˜é‡ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|----------|------|------|
| **_pb_** | å¸ƒå°”å‚æ•° | true æˆ– false |
| **_pn_** | æ•°å­—å‚æ•° | Int, Float, Real ç­‰ |
| **_ps_** | å­—ç¬¦ä¸²å‚æ•° | å¯ä»¥ç›´æ¥è¾“å…¥å­—ç¬¦ä¸² |
| **_pc_** | é¢œè‰²å‚æ•° | åå…­è¿›åˆ¶é¢œè‰²ä»£ç ï¼ˆ#00ff00ffï¼‰ |

### å¯¼å‡ºå˜é‡

å˜é‡å¿…é¡»åŒ…å«åœ¨è¿™äº›æ³¨é‡Š `//!export-start` å’Œ `//!export-end` ä¹‹é—´ï¼š

```javascript
//!export-start
let _pn_value = 50;
//!export-end
```

ç°åœ¨å˜é‡å°†åœ¨ FUXA çš„ SVG å±æ€§é¢æ¿ä¸­å¯ç”¨ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­ç»‘å®š FUXA æ ‡ç­¾ã€‚

---

## ğŸ“¤ å‘ FUXA å‘é€å€¼

### postValue å‡½æ•°

ä¸ºäº†ä» SVG å‘ FUXA å‘é€å€¼ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ `postValue` å‡½æ•°ï¼š

```javascript
function postValue(id, value) {
  console.error('Not defined!');
}
```

### ä½¿ç”¨ç¤ºä¾‹

æ‚¨éœ€è¦è°ƒç”¨è¯¥å‡½æ•°ï¼ŒID éœ€è¦ä¸ç¡®åˆ‡çš„å˜é‡åç§°åŒ¹é…ï¼š

```javascript
postValue('_pn_value', someNewValue);
```

### å®Œæ•´ç¤ºä¾‹

```javascript
// ä» SVG å‘ FUXA å‘é€å€¼
function updateValue(newValue) {
  postValue('_pn_value', newValue);
}

// åœ¨æŒ‰é’®ç‚¹å‡»æ—¶è°ƒç”¨
document.getElementById('myButton').addEventListener('click', function() {
  updateValue(100);
});
```

---

## ğŸ“¥ ä» FUXA æ¥æ”¶å€¼

### putValue å‡½æ•°

ä¸ºäº†ä» FUXA å‘ SVG æ¥æ”¶å€¼ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ `putValue` å‡½æ•°ï¼š

```javascript
function putValue(id, value) {
  if (id === '_pn_value') {
    callFunction(value);
    newVar = value;
  }
}
```

### ä½¿ç”¨ç¤ºä¾‹

åœ¨è¿™é‡Œæˆ‘ä»¬ç­‰å¾…å‡½æ•°åœ¨ FUXA ä¸­è¢«è°ƒç”¨ï¼Œå¹¶æ£€æŸ¥æˆ‘ä»¬è¦æ‰¾çš„ IDï¼Œå³å®šä¹‰çš„ç¡®åˆ‡å˜é‡åç§°ï¼š

```javascript
function putValue(id, value) {
  if (id === '_pn_value') {
    updateDisplay(value);
  } else if (id === '_pb_status') {
    updateStatus(value);
  }
}

function updateDisplay(value) {
  document.getElementById('display').textContent = value;
}

function updateStatus(value) {
  var statusElement = document.getElementById('status');
  if (value) {
    statusElement.setAttribute('fill', '#2ecc71');
  } else {
    statusElement.setAttribute('fill', '#e74c3c');
  }
}
```

---

## â±ï¸ å¤„ç†å®šæ—¶å™¨

### æ¸…é™¤å®šæ—¶å™¨

å¦‚æœæ‚¨ä½¿ç”¨ `setInterval`ï¼Œè¿˜éœ€è¦åœ¨æ›´æ”¹é¡µé¢æˆ–è¿›å…¥ç¼–è¾‘å™¨æ—¶æ¸…é™¤é—´éš”ï¼Œå¦‚æœä¸è¿™æ ·åšï¼Œå°ç»„ä»¶å°†ç”±äºè°ƒç”¨å¦ä¸€ä¸ª `setInterval` è€ŒæŸåã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æ£€æŸ¥å¯¹è±¡æ˜¯å¦å­˜åœ¨å¹¶ä½¿ç”¨ MutationObserverã€‚

### æ£€æŸ¥é”€æ¯

```javascript
const checkDestroy = document.getElementById('svgIdName'); // é‡è¦ï¼šå¿…é¡»æ˜¯ SVG çš„åç§°ï¼
if (!checkDestroy) {
  clearBlinking(); 
  return;
}
```

### Mutation Observer

```javascript
// è®¾ç½® MutationObserver ä»¥ç›‘è§† SVG å…ƒç´ çš„ç§»é™¤
const observer = new MutationObserver((mutations) => {
  mutations.forEach((mutation) => {
    mutation.removedNodes.forEach((node) => {
      if (node.id === 'svgIdName') { // é‡è¦ï¼šå¿…é¡»æ˜¯ SVG çš„åç§°ï¼
        clearBlinking(); 
        observer.disconnect(); 
      }
    });
  });
});
// å¼€å§‹è§‚å¯Ÿ body æˆ– SVG çš„çˆ¶å…ƒç´ 
observer.observe(document.body, { childList: true, subtree: true }); 
```

### å®Œæ•´ç¤ºä¾‹

```javascript
// è®¾ç½®å®šæ—¶å™¨
let blinkInterval = null;

function startBlinking() {
  if (blinkInterval) return;
  
  blinkInterval = setInterval(() => {
    const element = document.getElementById('blinkingElement');
    if (element) {
      const currentOpacity = element.getAttribute('opacity') || 1;
      const newOpacity = currentOpacity == 1 ? 0.3 : 1;
      element.setAttribute('opacity', newOpacity);
    }
  }, 500);
}

function clearBlinking() {
  if (blinkInterval) {
    clearInterval(blinkInterval);
    blinkInterval = null;
  }
}

// æ£€æŸ¥é”€æ¯
const checkDestroy = document.getElementById('svgIdName');
if (!checkDestroy) {
  clearBlinking(); 
  return;
}

// è®¾ç½® MutationObserver
const observer = new MutationObserver((mutations) => {
  mutations.forEach((mutation) => {
    mutation.removedNodes.forEach((node) => {
      if (node.id === 'svgIdName') {
        clearBlinking(); 
        observer.disconnect(); 
      }
    });
  });
});
observer.observe(document.body, { childList: true, subtree: true });
```

---

## ğŸ¨ ä½¿ç”¨ CSS å’Œ JavaScript

### CSS æ ·å¼

æ‚¨è¿˜å¯ä»¥åœ¨ SVG ä¸­ä½¿ç”¨ CSSï¼š

```html
<svg id="svgIdName" width="200" height="200" xmlns="http://www.w3.org/2000/svg">
  <style>
    .circle {
      fill: #3498db;
      stroke: #2c3e50;
      stroke-width: 2;
    }
    .text {
      font-family: Arial, sans-serif;
      font-size: 14px;
      fill: #2c3e50;
    }
  </style>
  <circle class="circle" cx="100" cy="100" r="50" />
  <text class="text" x="100" y="105" text-anchor="middle">Hello</text>
</svg>
```

### JavaScript è®¿é—®

æ‚¨å¯ä»¥ä½¿ç”¨å®Œæ•´çš„ JavaScript å¹¶ä½¿ç”¨æ ‡å‡†çš„ `getElementById` å’Œ `addEventListener` è®¿é—®å…ƒç´ /IDï¼š

```javascript
// è·å–å…ƒç´ 
const circle = document.getElementById('myCircle');
const text = document.getElementById('myText');

// æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
circle.addEventListener('click', function() {
  const currentFill = this.getAttribute('fill');
  const newFill = currentFill === '#3498db' ? '#e74c3c' : '#3498db';
  this.setAttribute('fill', newFill);
});

// æ›´æ–°æ–‡æœ¬
function updateText(newText) {
  text.textContent = newText;
}
```

---

## ğŸ’¡ å®Œæ•´ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šç®€å•è®¡æ•°å™¨

```html
<svg id="counterWidget" width="200" height="200" xmlns="http://www.w3.org/2000/svg">
  <style>
    .counter-text {
      font-family: Arial, sans-serif;
      font-size: 48px;
      fill: #2c3e50;
      text-anchor: middle;
    }
    .button {
      fill: #3498db;
      stroke: #2c3e50;
      stroke-width: 2;
      cursor: pointer;
    }
    .button:hover {
      fill: #2980b9;
    }
  </style>
  
  <rect x="50" y="50" width="100" height="60" class="button" id="incrementButton" />
  <text x="100" y="90" class="counter-text" id="counterDisplay">0</text>
  
  <script>
    //!export-start
    let _pn_count = 0;
    //!export-end
    
    const counterDisplay = document.getElementById('counterDisplay');
    const incrementButton = document.getElementById('incrementButton');
    
    function updateDisplay(value) {
      counterDisplay.textContent = value;
    }
    
    incrementButton.addEventListener('click', function() {
      _pn_count++;
      updateDisplay(_pn_count);
      postValue('_pn_count', _pn_count);
    });
    
    function putValue(id, value) {
      if (id === '_pn_count') {
        _pn_count = value;
        updateDisplay(_pn_count);
      }
    }
    
    function postValue(id, value) {
      console.error('Not defined!');
    }
  </script>
</svg>
```

### ç¤ºä¾‹ 2ï¼šçŠ¶æ€æŒ‡ç¤ºå™¨

```html
<svg id="statusWidget" width="200" height="200" xmlns="http://www.w3.org/2000/svg">
  <style>
    .status-circle {
      stroke: #2c3e50;
      stroke-width: 2;
    }
    .status-text {
      font-family: Arial, sans-serif;
      font-size: 16px;
      fill: #2c3e50;
      text-anchor: middle;
    }
  </style>
  
  <circle class="status-circle" cx="100" cy="80" r="40" id="statusCircle" />
  <text class="status-text" x="100" y="150" id="statusText">OFF</text>
  
  <script>
    //!export-start
    let _pb_status = false;
    let _ps_message = "OFF";
    //!export-end
    
    const statusCircle = document.getElementById('statusCircle');
    const statusText = document.getElementById('statusText');
    
    function updateStatus(status) {
      if (status) {
        statusCircle.setAttribute('fill', '#2ecc71');
        statusText.textContent = 'ON';
      } else {
        statusCircle.setAttribute('fill', '#e74c3c');
        statusText.textContent = 'OFF';
      }
    }
    
    function updateMessage(message) {
      statusText.textContent = message;
    }
    
    function putValue(id, value) {
      if (id === '_pb_status') {
        _pb_status = value;
        updateStatus(_pb_status);
      } else if (id === '_ps_message') {
        _ps_message = value;
        updateMessage(_ps_message);
      }
    }
    
    function postValue(id, value) {
      console.error('Not defined!');
    }
  </script>
</svg>
```

### ç¤ºä¾‹ 3ï¼šè¿›åº¦æ¡

```html
<svg id="progressWidget" width="300" height="100" xmlns="http://www.w3.org/2000/svg">
  <style>
    .progress-bg {
      fill: #ecf0f1;
      stroke: #2c3e50;
      stroke-width: 2;
    }
    .progress-bar {
      fill: #3498db;
      stroke: none;
    }
    .progress-text {
      font-family: Arial, sans-serif;
      font-size: 14px;
      fill: #2c3e50;
      text-anchor: middle;
    }
  </style>
  
  <rect class="progress-bg" x="10" y="20" width="280" height="30" />
  <rect class="progress-bar" x="10" y="20" width="0" height="30" id="progressBar" />
  <text class="progress-text" x="150" y="75" id="progressText">0%</text>
  
  <script>
    //!export-start
    let _pn_value = 0;
    let _pn_min = 0;
    let _pn_max = 100;
    //!export-end
    
    const progressBar = document.getElementById('progressBar');
    const progressText = document.getElementById('progressText');
    
    function updateProgress(value) {
      const percentage = Math.min(Math.max(value, _pn_min), _pn_max);
      const width = (percentage / (_pn_max - _pn_min)) * 280;
      progressBar.setAttribute('width', width);
      progressText.textContent = Math.round(percentage) + '%';
    }
    
    function putValue(id, value) {
      if (id === '_pn_value') {
        _pn_value = value;
        updateProgress(_pn_value);
      } else if (id === '_pn_min') {
        _pn_min = value;
        updateProgress(_pn_value);
      } else if (id === '_pn_max') {
        _pn_max = value;
        updateProgress(_pn_value);
      }
    }
    
    function postValue(id, value) {
      console.error('Not defined!');
    }
  </script>
</svg>
```

---

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### â“ å˜é‡ä¸æ˜¾ç¤ºåœ¨å±æ€§é¢æ¿

**å¯èƒ½åŸå› **ï¼š
- å˜é‡æœªåœ¨ `//!export-start` å’Œ `//!export-end` ä¹‹é—´
- å˜é‡å‘½åä¸æ­£ç¡®
- æ–‡ä»¶æœªæ­£ç¡®ä¿å­˜

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. ç¡®ä¿å˜é‡åœ¨æ³¨é‡Šä¹‹é—´
2. æ£€æŸ¥å˜é‡å‘½åæ ¼å¼
3. é‡æ–°åŠ è½½å°ç»„ä»¶

---

#### â“ å€¼æœªæ›´æ–°

**å¯èƒ½åŸå› **ï¼š
- `putValue` å‡½æ•°æœªæ­£ç¡®å®ç°
- ID ä¸åŒ¹é…
- æ ‡ç­¾æœªç»‘å®š

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ `putValue` å‡½æ•°å®ç°
2. éªŒè¯ ID æ˜¯å¦åŒ¹é…
3. ç¡®è®¤æ ‡ç­¾æ˜¯å¦ç»‘å®š

---

#### â“ å®šæ—¶å™¨æœªæ¸…é™¤

**å¯èƒ½åŸå› **ï¼š
- æœªä½¿ç”¨ MutationObserver
- SVG ID ä¸æ­£ç¡®
- æ¸…é™¤å‡½æ•°æœªè°ƒç”¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. å®ç° MutationObserver
2. ç¡®è®¤ SVG ID æ­£ç¡®
3. ç¡®ä¿æ¸…é™¤å‡½æ•°è¢«è°ƒç”¨

---

## ğŸ“š æœ€ä½³å®è·µ

### 1ï¸âƒ£ å‘½åè§„èŒƒ

- ä½¿ç”¨æœ‰æ„ä¹‰çš„å˜é‡å
- éµå¾ªå‘½åçº¦å®šï¼ˆ_pb_, _pn_, _ps_, _pc_ï¼‰
- ä¾‹å¦‚ï¼š`_pn_value`, `_pb_status`, `_ps_message`

### 2ï¸âƒ£ ä»£ç ç»„ç»‡

- å°†ç›¸å…³åŠŸèƒ½åˆ†ç»„
- ä½¿ç”¨æ³¨é‡Šè¯´æ˜ä»£ç 
- ä¿æŒä»£ç ç®€æ´

### 3ï¸âƒ£ æ€§èƒ½ä¼˜åŒ–

- é¿å…é¢‘ç¹çš„ DOM æ“ä½œ
- ä½¿ç”¨äº‹ä»¶å§”æ‰˜
- åŠæ—¶æ¸…é™¤å®šæ—¶å™¨

### 4ï¸âƒ£ é”™è¯¯å¤„ç†

- æ·»åŠ é”™è¯¯å¤„ç†
- éªŒè¯è¾“å…¥å‚æ•°
- æä¾›æœ‰æ„ä¹‰çš„é”™è¯¯æ¶ˆæ¯

---

## ğŸ‰ æ€»ç»“

é€šè¿‡æœ¬æ•™ç¨‹ï¼Œæ‚¨å·²ç»å­¦ä¼šäº†ï¼š

âœ… äº†è§£å°ç»„ä»¶ç»“æ„  
âœ… ä½¿ç”¨å…¨å±€å˜é‡ä¼ è¾“æ•°æ®  
âœ… å‘ FUXA å‘é€å€¼  
âœ… ä» FUXA æ¥æ”¶å€¼  
âœ… å¤„ç†å®šæ—¶å™¨  
âœ… ä½¿ç”¨ CSS å’Œ JavaScript  
âœ… åº”ç”¨å®Œæ•´ç¤ºä¾‹  
âœ… æ•…éšœæ’é™¤  
âœ… åº”ç”¨æœ€ä½³å®è·µ  

ç°åœ¨æ‚¨å¯ä»¥åœ¨ FUXA ä¸­åˆ›å»ºè‡ªå®šä¹‰å°ç»„ä»¶äº†ï¼

---

## ğŸ“š å¿«é€Ÿå‚è€ƒ

### å˜é‡ç±»å‹å¯¹ç…§è¡¨

| å˜é‡ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|----------|------|------|
| **_pb_** | å¸ƒå°”å‚æ•° | true æˆ– false |
| **_pn_** | æ•°å­—å‚æ•° | Int, Float, Real ç­‰ |
| **_ps_** | å­—ç¬¦ä¸²å‚æ•° | å¯ä»¥ç›´æ¥è¾“å…¥å­—ç¬¦ä¸² |
| **_pc_** | é¢œè‰²å‚æ•° | åå…­è¿›åˆ¶é¢œè‰²ä»£ç ï¼ˆ#00ff00ffï¼‰ |

### å‡½æ•°å¯¹ç…§è¡¨

| å‡½æ•° | è¯´æ˜ | ç”¨é€” |
|------|------|------|
| **postValue** | å‘ FUXA å‘é€å€¼ | ä» SVG å‘ FUXA å‘é€æ•°æ® |
| **putValue** | ä» FUXA æ¥æ”¶å€¼ | ä» FUXA å‘ SVG æ¥æ”¶æ•°æ® |

---

> ğŸ’¡ **æç¤º**ï¼šå»ºè®®åœ¨å®é™…åº”ç”¨ä¸­ä½¿ç”¨ MutationObserver æ¸…é™¤å®šæ—¶å™¨ï¼Œé¿å…å†…å­˜æ³„æ¼ã€‚æŸ¥çœ‹å°ç»„ä»¶éƒ¨åˆ†ä¸­çš„å®Œæ•´å·¥ä½œç¤ºä¾‹ï¼šhttps://github.com/frangoteam/FUXA/tree/master/server/_widgets

---

**å…³æ³¨æˆ‘ä»¬ï¼Œè·å–æ›´å¤šå·¥ä¸šè‡ªåŠ¨åŒ–æŠ€æœ¯å¹²è´§ï¼** ğŸ¯

<div style="display: flex; justify-content: center; align-items: center; gap: 40px; margin: 30px 0;">
    <div style="text-align: center;">
        <img src="images/å¾®ä¿¡å…¬ä¼—å·.jpg" alt="å¾®ä¿¡å…¬ä¼—å·" style="width: 200px; height: 200px; object-fit: contain;">
        <p style="margin: 10px 0 0 0; font-size: 14px; color: #666;">å¾®ä¿¡å…¬ä¼—å·</p>
    </div>
    <div style="text-align: center;">
        <img src="images/å•äººäºŒç»´ç .png" alt="æŠ€æœ¯æ”¯æŒ" style="width: 200px; height: 200px; object-fit: contain;">
        <p style="margin: 10px 0 0 0; font-size: 14px; color: #666;">æŠ€æœ¯æ”¯æŒ</p>
    </div>
</div>

