# 🔄 FUXA 视图复用教程

---

## 📋 概述

视图复用功能允许您为重复组件（如泵和阀门）使用相同的视图，提高开发效率并保持界面一致性。

---

## 🎯 应用场景

视图复用适用于以下场景：

| 场景 | 说明 | 示例 |
|------|------|------|
| **多个相同设备** | 多个相同类型的设备 | 多个泵、多个阀门 |
| **统一界面风格** | 保持界面风格一致 | 统一的设备控制界面 |
| **减少重复工作** | 避免重复创建相同界面 | 一次创建，多次使用 |
| **便于维护** | 集中管理界面逻辑 | 修改一处，全局生效 |

---

## 🔧 实现步骤

### 步骤 1：定义内部设备

创建一个内部设备，用于存储可复用视图所需的变量（标签）。

![定义内部设备](images/fuxa-reuse-view2.gif)

#### 配置说明

| 配置项 | 说明 | 示例 |
|--------|------|------|
| **设备名称** | 内部设备名称 | InternalDevice |
| **设备类型** | 设备类型 | Internal |
| **变量名称** | 变量名称 | pumpName, pumpStatus, targetValue |

#### 示例配置

```javascript
// 内部设备配置
{
  "name": "InternalDevice",
  "type": "internal",
  "variables": [
    {
      "name": "pumpName",
      "type": "string",
      "value": ""
    },
    {
      "name": "pumpStatus",
      "type": "number",
      "value": 0
    },
    {
      "name": "targetValue",
      "type": "number",
      "value": 0
    }
  ]
}
```

---

### 步骤 2：创建可复用视图

创建一个视图，将控件绑定到内部设备的变量。

![创建可复用视图](images/fuxa-reuse-view1.gif)

#### 视图设计

1. 添加显示控件（如文本框）绑定到 `pumpName`
2. 添加状态指示器绑定到 `pumpStatus`
3. 添加输入控件绑定到 `targetValue`
4. 添加确认按钮（可选）

#### 控件绑定示例

```javascript
// 标题显示
{
  type: "text",
  tagId: "pumpName",
  text: "{value}"
}

// 状态显示
{
  type: "circle",
  tagId: "pumpStatus",
  fillColor: {
    0: "#95a5a6",  // 停止
    1: "#2ecc71"   // 运行
  }
}

// 目标值输入
{
  type: "input",
  tagId: "targetValue",
  label: "目标值",
  unit: "%"
}
```

---

### 步骤 3：配置事件

在每个组件中配置事件，打开对话框并定义内部标签与设备标签的连接。

![配置事件](images/fuxa-reuse-view3.gif)

#### 事件配置

1. 选择要使用复用视图的组件
2. 添加点击事件
3. 选择动作类型为 **"Open Dialog"**（打开对话框）
4. 选择可复用视图
5. 配置标签映射

#### 标签映射示例

```javascript
// 泵 1 的事件配置
{
  "action": "Open Dialog",
  "view": "PumpControlView",
  "tagMappings": {
    "pumpName": "Pump1.name",
    "pumpStatus": "Pump1.status",
    "targetValue": "Pump1.targetValue"
  }
}

// 泵 2 的事件配置
{
  "action": "Open Dialog",
  "view": "PumpControlView",
  "tagMappings": {
    "pumpName": "Pump2.name",
    "pumpStatus": "Pump2.status",
    "targetValue": "Pump2.targetValue"
  }
}
```

---

### 步骤 4：添加确认按钮（可选）

如果需要，可以添加确认按钮来保存设置。

![添加确认按钮](images/fuxa-reuse-view4.gif)

#### 确认按钮配置

```javascript
// 确认按钮事件
{
  "action": "Set from Input and Close",
  "tagId": "targetValue",
  "inputId": "targetValueInput"
}
```

---

## 💡 完整示例

### 示例 1：泵控制界面

#### 主视图

```javascript
// 主视图：显示多个泵
{
  "view": "MainView",
  "components": [
    {
      "type": "pump",
      "name": "Pump1",
      "events": [
        {
          "type": "click",
          "action": "Open Dialog",
          "view": "PumpControlView",
          "tagMappings": {
            "pumpName": "Pump1.name",
            "pumpStatus": "Pump1.status",
            "targetValue": "Pump1.targetValue"
          }
        }
      ]
    },
    {
      "type": "pump",
      "name": "Pump2",
      "events": [
        {
          "type": "click",
          "action": "Open Dialog",
          "view": "PumpControlView",
          "tagMappings": {
            "pumpName": "Pump2.name",
            "pumpStatus": "Pump2.status",
            "targetValue": "Pump2.targetValue"
          }
        }
      ]
    }
  ]
}
```

#### 可复用视图

```javascript
// 可复用视图：泵控制
{
  "view": "PumpControlView",
  "controls": [
    {
      "type": "text",
      "tagId": "pumpName",
      "text": "泵: {value}"
    },
    {
      "type": "circle",
      "tagId": "pumpStatus",
      "fillColor": {
        0: "#95a5a6",
        1: "#2ecc71"
      }
    },
    {
      "type": "input",
      "tagId": "targetValue",
      "label": "目标值",
      "unit": "%"
    },
    {
      "type": "button",
      "text": "确认",
      "events": [
        {
          "type": "click",
          "action": "Set from Input and Close",
          "tagId": "targetValue"
        }
      ]
    }
  ]
}
```

---

### 示例 2：阀门控制界面

#### 主视图

```javascript
// 主视图：显示多个阀门
{
  "view": "MainView",
  "components": [
    {
      "type": "valve",
      "name": "Valve1",
      "events": [
        {
          "type": "click",
          "action": "Open Dialog",
          "view": "ValveControlView",
          "tagMappings": {
            "valveName": "Valve1.name",
            "valveStatus": "Valve1.status",
            "valvePosition": "Valve1.position"
          }
        }
      ]
    },
    {
      "type": "valve",
      "name": "Valve2",
      "events": [
        {
          "type": "click",
          "action": "Open Dialog",
          "view": "ValveControlView",
          "tagMappings": {
            "valveName": "Valve2.name",
            "valveStatus": "Valve2.status",
            "valvePosition": "Valve2.position"
          }
        }
      ]
    }
  ]
}
```

#### 可复用视图

```javascript
// 可复用视图：阀门控制
{
  "view": "ValveControlView",
  "controls": [
    {
      "type": "text",
      "tagId": "valveName",
      "text": "阀门: {value}"
    },
    {
      "type": "diamond",
      "tagId": "valveStatus",
      "fillColor": {
        0: "#95a5a6",
        1: "#2ecc71"
      }
    },
    {
      "type": "slider",
      "tagId": "valvePosition",
      "label": "阀门位置",
      "min": 0,
      "max": 100,
      "unit": "%"
    },
    {
      "type": "button",
      "text": "确认",
      "events": [
        {
          "type": "click",
          "action": "Set from Input and Close",
          "tagId": "valvePosition"
        }
      ]
    }
  ]
}
```

---

## 🔧 故障排除

### 常见问题

#### ❓ 标签映射不正确

**可能原因**：
- 标签名称拼写错误
- 标签不存在
- 数据类型不匹配

**解决方案**：
1. 检查标签名称是否正确
2. 确认标签是否存在
3. 验证数据类型是否匹配

---

#### ❓ 对话框不显示

**可能原因**：
- 视图未正确配置
- 事件未正确触发
- 权限不足

**解决方案**：
1. 检查视图配置
2. 验证事件触发条件
3. 确认用户权限

---

#### ❓ 值未更新

**可能原因**：
- 标签映射错误
- 设备未连接
- 权限不足

**解决方案**：
1. 检查标签映射
2. 确认设备连接状态
3. 验证用户权限

---

## 📚 最佳实践

### 1️⃣ 命名规范

- 使用有意义的名称
- 保持命名一致性
- 例如：`PumpControlView`、`ValveControlView`

### 2️⃣ 模块化设计

- 将复杂视图分解为简单组件
- 创建可重用的子视图
- 提高代码可维护性

### 3️⃣ 文档化

- 记录可复用视图的用途
- 说明标签映射关系
- 提供使用示例

### 4️⃣ 测试

- 在开发环境中充分测试
- 验证所有标签映射
- 确认事件正常触发

---

## 🎉 总结

通过本教程，您已经学会了：

✅ 定义内部设备  
✅ 创建可复用视图  
✅ 配置事件和标签映射  
✅ 添加确认按钮  
✅ 应用完整示例  
✅ 故障排除  
✅ 应用最佳实践  

现在您可以在 FUXA 中高效地复用视图了！

---

## 📚 快速参考

### 视图复用步骤对照表

| 步骤 | 操作 | 说明 |
|------|------|------|
| **1** | 定义内部设备 | 创建内部设备和变量 |
| **2** | 创建可复用视图 | 设计视图并绑定控件 |
| **3** | 配置事件 | 配置打开对话框事件 |
| **4** | 添加确认按钮（可选） | 添加确认按钮保存设置 |

---

> 💡 **提示**：建议在实际应用中为每个可复用视图添加清晰的说明和文档，便于其他开发者理解和使用。

---

**关注我们，获取更多工业自动化技术干货！** 🎯

<div style="display: flex; justify-content: center; align-items: center; gap: 40px; margin: 30px 0;">
    <div style="text-align: center;">
        <img src="images/微信公众号.jpg" alt="微信公众号" style="width: 200px; height: 200px; object-fit: contain;">
        <p style="margin: 10px 0 0 0; font-size: 14px; color: #666;">微信公众号</p>
    </div>
    <div style="text-align: center;">
        <img src="images/单人二维码.png" alt="技术支持" style="width: 200px; height: 200px; object-fit: contain;">
        <p style="margin: 10px 0 0 0; font-size: 14px; color: #666;">技术支持</p>
    </div>
</div>

